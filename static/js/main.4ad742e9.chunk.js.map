{"version":3,"sources":["sections/Chat/index.module.scss","components/OfflineCheck/index.module.scss","sections/Chat/OnlineUsers/index.module.scss","sections/Login/index.module.scss","assets/sounds/newMessage.mp3","sections/Chat/Messages/Message/index.module.scss","store/types.ts","constants.ts","sections/Admin/RealtimeChart/index.tsx","lib/secondsToHuman.ts","util/socketProvider.tsx","sections/Admin/index.tsx","store/reducer.ts","store/state.tsx","components/Logo/index.tsx","components/Loader/index.tsx","sections/Chat/Messages/Message/HelpMessage/index.tsx","sections/Chat/Messages/Message/index.tsx","sections/Chat/Messages/ScrollBox/index.tsx","sections/Chat/Messages/index.tsx","sections/Chat/TextBox/index.tsx","sections/Chat/OnlineUsers/index.tsx","util/fetch.ts","sections/Chat/PasswordLock/index.tsx","sections/Chat/index.tsx","sections/loading/index.tsx","util/AuthenticatedRoute.tsx","util/UnauthenticatedRoute.tsx","components/OfflineCheck/index.tsx","sections/Login/index.tsx","util/checkAuth.ts","router.tsx","components/Title/index.tsx","lib/dateDiff.ts","lib/icons.ts","index.tsx","sections/Chat/PasswordLock/index.module.scss","components/Logo/index.module.scss","sections/Chat/Messages/index.module.scss","sections/Chat/TextBox/index.module.scss"],"names":["module","exports","EVENTS","CONNECT","DISCONNECT","MESSAGE","COMMAND","HISTORY","ONLINE_USERS","STATS","TIMER","CONTROL","CHANGE_ROOM","API_URL","process","VALID_USERNAME","CAPTCHA_KEY","props","data","map","num","index","date","value","i","length","MAX_STATS_BARS","push","style","width","height","barSize","barCategoryGap","barGap","margin","top","bottom","left","right","allowDecimals","dataKey","tick","label","position","offset","fill","stroke","isAnimationActive","type","cursor","forHumans","seconds","levels","Math","floor","returntext","max","substr","trim","SocketContext","createContext","socket","useGlobalState","state","dispatch","useState","setSocket","hasPassword","auth","user","useEffect","loggedIn","payload","newSocket","socketio","reconnection","timeout","setInterval","connected","emit","setTimeout","Object","values","forEach","event","on","error","provider","Provider","children","useContext","totalTime","stats","timeActive","timeInactive","tableData","header","onlineUsers","round","totalUsers","totalMessages","cpuUsage","freeMemory","uptime","sessions","roomData","rooms","Container","fluid","Row","Col","RealtimeChart","messages","users","onClick","room","activePayload","id","domain","stackId","Table","size","variant","className","row","key","produce","draft","action","offline","checked","systemMessage","systemUser","message","timestamp","Date","attributes","private","existingDraft","findIndex","eachMessage","user_id","splice","lastMessage","shift","keys","name","icon","color","isActive","initialState","draftTimer","Array","StateContext","React","console","warn","StateProvider","useReducer","reducer","infinite","animationIterationCount","animationDirection","styles","logo","blob","svgFilter","xmlns","version","in","stdDeviation","result","mode","in2","Logo","href","rel","target","USER_REGEX","RegExp","URL_REGEX","userData","find","userColor","isSystem","isUserOnline","iconName","HelpMessage","reactStringReplace","username","userIndex","mention","url","classNames","system","inactive","toDateString","background","OverlayTrigger","placement","overlay","Tooltip","spin","toLocaleTimeString","hour","minute","body","boxRef","onScrollChanged","threshold","scrollTop","setScrollTop","setHeight","scrollDebounce","useRef","onScrollDebounced","useCallback","isAtBottom","clearTimeout","current","scrollToBottom","scrollHeight","offsetHeight","updateScrollState","shouldScroll","customThreshold","abs","window","addEventListener","removeEventListener","newHeight","useImmer","scrollAtBottom","unseenMessages","localState","setLocalState","chatAreaRef","unseen","unseenContainer","Button","messageScroll","ref","ScrollBox","Message","getTime","onFocus","onBlur","to","isCommand","setState","askForHelp","sendMessage","Form","noValidate","onSubmit","e","preventDefault","textBox","command","Group","controlId","Control","as","placeholder","autoFocus","onChange","currentTarget","isPM","words","split","test","textIcon","isCurrentUser","csrfToken","axios","defaults","withCredentials","fetchResource","path","method","a","Error","options","xsrfHeaderName","headers","response","status","parseAxiosError","errors","parseErrorList","join","defaultError","isArray","parseErrors","useFetch","showModal","setShowModal","validated","setValidated","password","setPassword","repeatPassword","setRepeatPassword","buttonClass","unlocked","buttonIcon","tooltipText","title","locked","passwordLock","delay","padding","Modal","show","onHide","stopPropagation","checkValidity","then","catch","reason","Header","closeButton","Title","Body","required","minLength","Feedback","pattern","Footer","footer","isTextBoxFocused","scrollingWhileFocused","chatArea","Loader","setHeaderPosition","headerStyle","pageYOffset","chat","scrollingChat","PasswordLock","isAdmin","marginLeft","OnlineUsers","Messages","TextBox","exact","component","String","verified","loading","captchaRef","oncaptchaChange","token","captchaToken","resetCaptcha","theme","matchMedia","matches","login","execute","disabled","maxLength","sitekey","CAPTCHA_PROVIDER","visibility","checkAuth","OfflineCheck","UnauthenticatedRoute","Login","AuthenticatedRoute","Admin","Chat","lastSound","windowFocused","titleNotification","useSound","newMessageSound","interrupt","volume","play","onMessage","msg","t1","t2","dateDiff","library","add","faLock","faLockOpen","faCircle","faDotCircle","farDotCircle","faCircleNotch","faCode","faCog","faArrowAltCircleDown","faMeh","farMeh","faAngry","faDizzy","faFlushed","faFrown","faFrownOpen","faGrimace","faGrin","faGrinAlt","faGrinBeam","faGrinBeamSweat","faGrinHearts","faGrinSquint","faGrinSquintTears","faGrinStars","faGrinTears","faGrinTongue","faGrinTongueSquint","faGrinTongueWink","faGrinWink","faKiss","faKissBeam","faKissWinkHeart","faLaugh","faLaughBeam","faLaughSquint","faLaughWink","faMehBlank","faMehRollingEyes","faSadCry","faSadTear","faSmile","faSmileBeam","faSmileWink","faSurprise","faTired","farAngry","farDizzy","farFlushed","farFrown","farFrownOpen","farGrimace","farGrin","farGrinAlt","farGrinBeam","farGrinBeamSweat","farGrinHearts","farGrinSquint","farGrinSquintTears","farGrinStars","farGrinTears","farGrinTongue","farGrinTongueSquint","farGrinTongueWink","farGrinWink","farKiss","farKissBeam","farKissWinkHeart","farLaugh","farLaughBeam","farLaughSquint","farLaughWink","farMehBlank","farMehRollingEyes","farSadCry","farSadTear","farSmile","farSmileBeam","farSmileWink","farSurprise","farTired","faShieldAlt","faQuestionCircle","app","basename","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.4ad742e9.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"chat\":\"Chat_chat__LEZtX\",\"scrollingChat\":\"Chat_scrollingChat__165RB\",\"header\":\"Chat_header__ThKzr\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"offline\":\"OfflineCheck_offline__2vKbm\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"onlineUsers\":\"OnlineUsers_onlineUsers__2Umxk\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"login\":\"Login_login__38Hzs\"};","module.exports = __webpack_public_path__ + \"static/media/newMessage.482e2f99.mp3\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"message\":\"Message_message__2v30T\",\"mention\":\"Message_mention__82QFp\",\"system\":\"Message_system__2g6ZE\",\"user\":\"Message_user__3HofW\",\"timestamp\":\"Message_timestamp__2armv\",\"offline\":\"Message_offline__32gHu\",\"icon\":\"Message_icon__ATXFm\",\"inactive\":\"Message_inactive__2OBrK\",\"body\":\"Message_body__32TEj\",\"draft\":\"Message_draft__1zB7h\",\"header\":\"Message_header__3wUCX\",\"private\":\"Message_private__ORZ48\"};","import { IconName } from \"@fortawesome/fontawesome-svg-core\"\n\nexport type User = {\n  user_id: string\n  name: string\n  color: string\n  icon: IconName | null\n  isActive: boolean\n  isAdmin?: boolean\n  hasPassword: boolean\n}\n\nexport type Message = {\n  user: User\n  timestamp: Date\n  message: string\n  attributes: {\n    draft: boolean\n    private: boolean\n    to?: string | null\n  }\n}\n\nexport type RoomStats = {\n  id: string,\n  active: number,\n  inactive: number,\n}\n\nexport type AppState = {\n  auth: {\n    checked: boolean\n    loggedIn: boolean\n    user: User | null\n  }\n  socket: {\n    connected: boolean\n  }\n  draftTimer: number,\n  onlineUsers: User[]\n  messages: Message[]\n  stats: {\n    messages: number[],\n    users: number[],\n    rooms: RoomStats[],\n    onlineUsers: number,\n    totalMessages: number,\n    totalUsers: number,\n    cpuUsage: number,\n    freeMemory: number,\n    uptime: number,\n    timeActive: number,\n    timeInactive: number,\n    sessions: number,\n  }\n  offline: boolean\n  error: string | null\n\n  [key: string]: any\n}\n\nexport type Action = {\n  type: string\n  payload?: any\n}\n\nexport type AppContext = {\n  state: AppState\n  dispatch: React.Dispatch<Action>\n}\n\nexport type AuthData = {\n  user: User\n  token: string\n}\n\nexport const EVENTS = {\n  CONNECT: 'connect',\n  DISCONNECT: 'disconnect',\n  MESSAGE: 'message',\n  COMMAND: 'command',\n  HISTORY: 'history',\n  ONLINE_USERS: 'users',\n  STATS: 'stats',\n  TIMER: 'timer',\n  CONTROL: 'control',\n  CHANGE_ROOM: 'change_room',\n};","export const API_URL = process.env.REACT_APP_API_URL || 'https://api.dotdot.im'\nexport const VALID_USERNAME = /^[A-Za-z0-9]+(?:[ _][A-Za-z0-9]+)*_?$/i\nexport const CAPTCHA_PROVIDER = process.env.REACT_APP_CAPTCHA_PROVIDER || 'recaptcha'\nexport const CAPTCHA_KEY = process.env.REACT_APP_CAPTCHA_KEY || ''\nexport const MAX_MESSAGE_HISTORY = 100\n","import React from 'react'\nimport { AreaChart, XAxis, YAxis, Area, Tooltip, ResponsiveContainer, Label } from 'recharts'\nimport { MAX_STATS_BARS } from '..';\n\ntype Props = {\n  data: number[],\n  height?: number,\n  label: string,\n};\n\nexport default (props: Props) => {\n  const data = props.data.map((num, index) => ({\n    date: index,\n    value: num,\n  }))\n\n  for (let i = data.length; i < MAX_STATS_BARS; i++) {\n    data.push({\n      date: i,\n      value: 0,\n    })\n  }\n\n  return (\n    <div style={ { width: '100%', height: `${ props.height || 250 }px` } }>\n      <ResponsiveContainer>\n        <AreaChart data={data} barSize={ 5 } barCategoryGap={ 2 } barGap={ 2 } margin={{ top: 50, bottom: 20, left: 0, right: 0}}>\n          <YAxis allowDecimals={ false } />\n          <XAxis dataKey=\"date\" tick={false}>\n            <Label value={ props.label } position=\"bottom\" offset={ -15 } fill='#ccc' />\n          </XAxis>\n          <Area dataKey=\"value\" fill=\"#f75f00\" stroke=\"#f75f00\" isAnimationActive={ false } type='linear' />\n          <Tooltip cursor={ { fill: 'rgba(255, 255, 255, 0.1)' } }/>\n        </AreaChart>\n      </ResponsiveContainer>\n    </div>\n  )\n}","export function forHumans ( seconds: number ) {\n  const levels: [number, string][] = [\n      [Math.floor(seconds / 31536000), 'years'],\n      [Math.floor((seconds % 31536000) / 86400), 'days'],\n      [Math.floor(((seconds % 31536000) % 86400) / 3600), 'hours'],\n      [Math.floor((((seconds % 31536000) % 86400) % 3600) / 60), 'minutes'],\n      [(((seconds % 31536000) % 86400) % 3600) % 60, 'seconds'],\n  ];\n  let returntext = '';\n\n  for (let i = 0, max = levels.length; i < max; i++) {\n      if ( levels[i][0] === 0 ) continue;\n      returntext += ' ' + levels[i][0] + ' ' + (levels[i][0] === 1 ? levels[i][1].substr(0, levels[i][1].length-1): levels[i][1]);\n  };\n  return returntext.trim();\n}","import React, { createContext, useEffect, useState } from 'react'\nimport socketio from 'socket.io-client'\n\nimport { useGlobalState } from 'store/state'\nimport { API_URL } from '../constants'\nimport { Message, EVENTS } from 'store/types'\n\nconst USAGE_TIMER_INTERAL = 30 * 1000\n\ntype SocketContextType = {\n  socket: SocketIOClient.Socket | null\n}\n\nexport const SocketContext = createContext<SocketContextType>({\n  socket: null,\n})\n\ntype Props = {\n  children: any\n}\n\nexport default (props: Props) => {\n  const { state, dispatch } = useGlobalState()\n  const [socket, setSocket] = useState<SocketIOClient.Socket | null>(null)\n\n  const hasPassword = state.auth.user?.hasPassword;\n\n  useEffect(() => {\n    if (!state.auth.loggedIn) {\n      return\n    }\n\n    // socket already set up\n    if (socket) {\n      return;\n    }\n\n    // clear any errors\n    dispatch({\n      type: 'error',\n      payload: null,\n    })\n\n    // initialize the socket\n    const newSocket = socketio(API_URL, {\n      reconnection: true,\n      timeout: 2000,\n    })\n\n    setInterval(() => {\n      if (newSocket.connected) {\n        newSocket.emit('timer')\n      }\n    }, USAGE_TIMER_INTERAL)\n\n    // remind to set a password\n    if (!hasPassword) {\n      setTimeout(() => {\n        dispatch({\n          type: 'system_message',\n          payload: 'Remember: If you want to keep this username, you must set a password! You can set it by clicking on the lock icon on the top left of the screen.'\n        })\n      }, 60 * 1000);\n    }\n\n    Object.values(EVENTS).forEach(event => {\n      newSocket.on(event, (payload: any) => {\n        dispatch({\n          type: `socket_${event}`,\n          payload: payload,\n        })\n      })\n    })\n\n    newSocket.on('stats', (payload: Message[]) => {\n      dispatch({\n        type: 'stats',\n        payload,\n      })\n    })\n\n    newSocket.on('connect_error', () => {\n      dispatch({\n        type: 'offline',\n        payload: null,\n      })\n    })\n\n    newSocket.on('connect_timeout', () => {\n      dispatch({\n        type: 'offline',\n        payload: null,\n      })\n    })\n\n    newSocket.on('error', (error: string) => {\n      dispatch({\n        type: `socket_${EVENTS.DISCONNECT}`,\n      })\n\n      if (error) {\n        dispatch({\n          type: 'error',\n          payload: error,\n        })\n        dispatch({\n          type: 'login',\n          payload: null,\n        })\n      } else {\n        dispatch({\n          type: 'offline',\n          payload: null,\n        })\n      }\n    })\n\n    setSocket(newSocket)\n  }, [dispatch, socket, state.auth.loggedIn, hasPassword])\n\n  let provider = {\n    socket,\n  }\n\n  return (\n    <SocketContext.Provider value={provider}>\n      {props.children}\n    </SocketContext.Provider>\n  )\n}\n","import React, { useContext } from 'react'\nimport { Container, Row, Col, Table } from 'react-bootstrap'\nimport { BarChart, XAxis, YAxis, Bar, Tooltip, ResponsiveContainer, Label } from 'recharts'\n\nimport useGlobalState from 'store/state';\nimport RealtimeChart from './RealtimeChart';\nimport { forHumans } from 'lib/secondsToHuman';\nimport { SocketContext } from 'util/socketProvider';\nimport { EVENTS } from 'store/types';\n\nexport const MAX_STATS_BARS = 100;\n\nexport default () => {\n  const { state } = useGlobalState()\n\n  const { socket } = useContext(SocketContext)\n\n  const totalTime = state.stats.timeActive + state.stats.timeInactive\n\n  const tableData = [\n    {\n      header: 'Users Online',\n      data: `${state.stats.onlineUsers}  (${Math.round(state.stats.onlineUsers * 100 / state.stats.totalUsers)}%)`,\n    },\n    {\n      header: 'Total Users',\n      data: state.stats.totalUsers,\n    },\n    {\n      header: 'Total Messages',\n      data: state.stats.totalMessages,\n    },\n    {\n      header: 'CPU Usage',\n      data: state.stats.cpuUsage + '%',\n    },\n    {\n      header: 'Free Memory',\n      data: state.stats.freeMemory + '%',\n    },\n    {\n      header: 'Server Uptime',\n      data: forHumans(state.stats.uptime),\n    },\n    {\n      header: 'Time Active / Ses',\n      data: forHumans(Math.round(state.stats.timeActive / state.stats.sessions)),\n    },\n    {\n      header: 'Time Inactive / Sess',\n      data: forHumans(Math.round(state.stats.timeInactive / state.stats.sessions)),\n    },\n    {\n      header: 'Total Sessions',\n      data: state.stats.sessions,\n    },\n    {\n      header: 'Avg Sessions / user',\n      data: Math.round(state.stats.sessions / state.stats.totalUsers),\n    },\n    {\n      header: 'Total Time Active',\n      data: forHumans(state.stats.timeActive) + ' (' + Math.round(state.stats.timeActive * 100 / totalTime) + '%)',\n    },\n    {\n      header: 'Total Time Inactive',\n      data: forHumans(state.stats.timeInactive) + ' (' + Math.round(state.stats.timeInactive * 100 / totalTime) + '%)',\n    },\n  ]\n\n  const roomData = state.stats.rooms\n\n  const onRoomClick = (event: any) => {\n    const room = event.activePayload[0].payload.id\n    if (socket) {\n      socket.emit(EVENTS.CHANGE_ROOM, {\n        room,\n      })\n    }\n  }\n\n  return (\n    <Container fluid>\n      <Row>\n        <Col>\n          <RealtimeChart\n            data={ state.stats.messages }\n            label='Realtime Messages'\n          />\n        </Col>\n        <Col>\n          <RealtimeChart\n            data={ state.stats.users }\n            label='Realtime Users'\n          />\n        </Col>\n      </Row>\n      <Row>\n        <Col>\n          <div style={ { width: '100%', height: '400px' } }>\n            <ResponsiveContainer>\n              <BarChart onClick={ onRoomClick } data={roomData} barSize={ 10 } margin={{ top: 50, bottom: 0, left: 0, right: 0}}>\n                <YAxis allowDecimals={ false } domain={ [ 0, 10 ] } />\n                <XAxis tick={false}>\n                  <Label value='Rooms' position=\"bottom\" offset={ -15 } fill='#ccc' />\n                </XAxis>\n                <Bar dataKey=\"active\" stackId='a' fill=\"#f75f00\" />\n                <Bar dataKey=\"inactive\" stackId='a' fill=\"#555\" />\n                <Tooltip cursor={ { fill: 'rgba(255, 255, 255, 0.1)' } }/>\n              </BarChart>\n            </ResponsiveContainer>\n          </div>\n        </Col>\n      </Row>\n      <Container>\n        <Row>\n          <Col>\n            <Table size='sm' variant=\"dark\" className='mt-4'>\n              <tbody>\n                { tableData.map(row => (\n                  <tr key={ row.header }>\n                    <th style={ { width: '230px' } }>\n                      { row.header }\n                    </th>\n                    <td>\n                      { row.data }\n                    </td>\n                  </tr>\n                )) }\n              </tbody>\n            </Table>\n          </Col>\n        </Row>\n      </Container>\n    </Container>\n  )\n}","import produce from 'immer'\n\nimport { AppState, Action, Message, EVENTS, User } from './types'\nimport { MAX_MESSAGE_HISTORY } from '../constants'\nimport { MAX_STATS_BARS } from 'sections/Admin'\n\n// TODO NEW BLOG POST\n// const REDUCER = {\n//   [REDUX_CONSTANTS.LOGIN]: (draft, payload) => {},\n// };\n\nexport default produce((draft: AppState, action: Action) => {\n  // REDUCER[action.type](draft, action.payload);\n  // console.log('REDUCER', action)\n\n  switch (action.type) {\n    case 'login':\n      if (!draft.offline) {\n        draft.auth.checked = true\n      }\n\n      if (!action.payload) {\n        draft.auth.loggedIn = false\n        draft.auth.user = null\n        break\n      }\n\n      draft.offline = false\n\n      draft.auth.loggedIn = true\n      draft.auth.user = action.payload.user\n      break\n    case 'offline':\n      draft.offline = true\n      draft.error = null\n      draft.socket.connected = false\n      break\n    case 'error':\n      draft.error = action.payload\n      break\n    case 'user_password':\n      if (draft.auth.user) {\n        draft.auth.user.hasPassword = true\n      }\n      break\n    case 'system_message':\n      const systemMessage = {\n        user: systemUser,\n        message: action.payload,\n        timestamp: new Date(),\n        attributes: {\n          private: false,\n          draft: false,\n        }\n      };\n      draft.messages.push(systemMessage)\n      break;\n    case `socket_${EVENTS.CONNECT}`:\n      draft.socket.connected = true\n      draft.offline = false\n      draft.error = null\n      break\n    case `socket_${EVENTS.DISCONNECT}`:\n      draft.socket.connected = false\n      draft.offline = true\n      draft.error = null\n      break\n    case `socket_${EVENTS.ONLINE_USERS}`:\n      draft.onlineUsers = action.payload.users\n      break\n    case `socket_${EVENTS.MESSAGE}`:\n      const message: Message = action.payload\n      // delete draft from this user\n      const existingDraft = draft.messages.findIndex(\n        (eachMessage) =>\n          eachMessage.attributes.draft &&\n          eachMessage.user.user_id === message.user.user_id\n      )\n      if (existingDraft > -1) {\n        draft.messages.splice(existingDraft, 1)\n      }\n\n      if (message.message.trim().length < 1) {\n        return;\n      }\n\n      if (!message.attributes.draft) {\n        const lastMessage = draft.messages[draft.messages.length - 1]\n\n        if (lastMessage && lastMessage.user.user_id === message.user.user_id && lastMessage.attributes.private === message.attributes.private) {\n          // last message was by this same user (and it's the same kind of message)\n          lastMessage.message += `\\n${message.message}`\n          lastMessage.timestamp = new Date(message.timestamp)\n          return\n        }\n      }\n\n      draft.messages.push({\n        timestamp: new Date(message.timestamp),\n        attributes: message.attributes,\n        message: message.message,\n        user: message.user,\n      })\n\n      if (draft.messages.length > MAX_MESSAGE_HISTORY) {\n        draft.messages.shift()\n      }\n      break;\n    case `socket_${EVENTS.HISTORY}`:\n      draft.messages = action.payload.map((eachMessage: Message) => {\n        eachMessage.timestamp = new Date(eachMessage.timestamp)\n        return eachMessage\n      });\n      break;\n    case `socket_${EVENTS.STATS}`:\n      draft.stats.messages.push(action.payload.messages)\n      if (draft.stats.messages.length > MAX_STATS_BARS) {\n        draft.stats.messages.shift()\n      }\n\n      draft.stats.users.push(action.payload.users)\n      if (draft.stats.users.length > MAX_STATS_BARS) {\n        draft.stats.users.shift()\n      }\n\n      draft.stats.rooms = action.payload.rooms\n      draft.stats.onlineUsers = action.payload.users\n      draft.stats.totalUsers = action.payload.totalUsers\n      draft.stats.totalMessages = action.payload.totalMessages\n      draft.stats.cpuUsage = Math.round(action.payload.cpuUsage * 100)\n      draft.stats.freeMemory = Math.round(action.payload.freeMemory * 100)\n      draft.stats.uptime = Math.round(action.payload.uptime)\n      draft.stats.timeActive = action.payload.timeActive * 30\n      draft.stats.timeInactive = action.payload.timeInactive * 30\n      draft.stats.sessions = action.payload.sessions\n      break;\n    case `socket_${EVENTS.CONTROL}`:\n      Object.keys(action.payload).forEach(key => {\n        if (typeof draft[key] !== 'undefined') {\n          draft[key] = action.payload[key]\n        }\n      })\n  }\n})\n\nconst systemUser: User = {\n  user_id: 'dotdot',\n  name: 'dotdot',\n  icon: 'cog',\n  color: 'f75f00',\n  isActive: true,\n  hasPassword: true,\n};","import React from 'react'\n\nimport reducer from './reducer'\nimport { AppState, AppContext, Action } from './types'\nimport { MAX_STATS_BARS } from 'sections/Admin'\n\nexport const initialState: AppState = {\n  auth: {\n    checked: false,\n    loggedIn: false,\n    user: null,\n  },\n  socket: {\n    connected: false,\n  },\n  draftTimer: 100,\n  onlineUsers: [],\n  messages: [],\n  stats: {\n    messages: new Array(MAX_STATS_BARS).fill(0),\n    users: new Array(MAX_STATS_BARS).fill(0),\n    rooms: [],\n    onlineUsers: 0,\n    totalUsers: 0,\n    totalMessages: 0,\n    cpuUsage: 0,\n    freeMemory: 0,\n    uptime: 0,\n    timeActive: 0,\n    timeInactive: 0,\n    sessions: 1,\n  },\n  offline: false,\n  error: null,\n}\nconst defaultDispatch: React.Dispatch<Action> = () => {\n  console.warn('Using default reducer, check StateProvider')\n  return initialState\n}\nexport const StateContext = React.createContext<AppContext>({\n  state: initialState,\n  dispatch: defaultDispatch,\n})\n\ntype Props = {\n  state?: AppState,\n  children: any\n}\n\nexport const StateProvider = (props: Props) => {\n  const [state, dispatch] = React.useReducer(reducer, props.state || initialState)\n  // TODO: if value is not \"any\" then typescript has an issue with readonly state values\n  const value: any = { state, dispatch }\n  return (\n    <StateContext.Provider value={value}>\n      {props.children}\n    </StateContext.Provider>\n  )\n}\n\nexport const useGlobalState = (): AppContext => React.useContext(StateContext)\nexport default useGlobalState\n","import React from 'react'\n\nimport styles from './index.module.scss'\n\ntype Props = {\n  infinite?: boolean\n}\n\nexport default (props: Props) => {\n  const style: any = {}\n  if (props.infinite) {\n    style.animationIterationCount = 'infinite'\n    style.animationDirection = 'alternate'\n  }\n  return (\n    <>\n      <div className={styles.logo}>\n        <div className={styles.blob} style={style}></div>\n        <div className={styles.blob} style={style}></div>\n      </div>\n\n      <svg\n        className={styles.svgFilter}\n        xmlns=\"http://www.w3.org/2000/svg\"\n        version=\"1.1\"\n      >\n        <defs>\n          <filter id=\"goo\">\n            <feGaussianBlur\n              in=\"SourceGraphic\"\n              stdDeviation=\"10\"\n              result=\"blur\"\n            />\n            <feColorMatrix\n              in=\"blur\"\n              mode=\"matrix\"\n              values=\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7\"\n              result=\"goo\"\n            />\n            <feBlend in=\"SourceGraphic\" in2=\"goo\" />\n          </filter>\n        </defs>\n      </svg>\n    </>\n  )\n}\n","import React from 'react'\nimport Logo from 'components/Logo'\n\ntype Props = {\n  text?: string | null\n}\n\nexport default (props: Props) => {\n  return (\n    <>\n      <Logo infinite />\n    </>\n  )\n}\n","import React from 'react'\nimport { Table } from 'react-bootstrap'\n\nexport default () => {\n  return (\n    <div>\n      <h4>Welcome to dotdot:</h4>\n      <p>\n        This is a place where you can chat with people whenever you want :)<br />\n        We don't save any messages, so when the last person in a chat disconnects, the chat history is lost.\n      </p>\n      <p>Inactive user accounts are deleted after 2 weeks without chatting.</p>\n\n      <h4>Keep your User</h4>\n      <p>You can set a password to protect your username from being deleted and used by someone else. Simply click on the lock in the top left corner.</p>\n\n      <h4>Private Messages</h4>\n      <p>You can send anyone a private message simply by starting your message with @ and their name. You'll see the text box change to orange and a lock icon appear.</p>\n      <p>Only you and the person you send the message to can see them. If they are offline they won't receive the message</p>\n\n      <h4>Commands</h4>\n      <p>There are some commands that you can use:</p>\n      <Table size='sm' variant='dark'>\n        <thead>\n          <tr>\n            <th>Command</th>\n            <th>Example</th>\n            <th>Description</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr>\n            <td><code>/help</code></td>\n            <td><code>/help</code></td>\n            <td>It shows this message</td>\n          </tr>\n          <tr>\n            <td><code>/set color</code></td>\n            <td><code>/set color eb0000</code></td>\n            <td>Change your color, the color needs to be a hex representation (sorry if this sounds confusing, soon there will be an easier way to do this)</td>\n          </tr>\n          <tr>\n            <td><code>/set icon</code></td>\n            <td><code>/set icon smile</code></td>\n            <td>Change your icon, pick any of the ones from <a href=\"https://fontawesome.com/icons?d=gallery&s=regular&c=emoji&m=free\" rel=\"noopener noreferrer\" target='_blank'>this list</a></td>\n          </tr>\n          <tr>\n            <td><code>/list</code></td>\n            <td><code>/list</code></td>\n            <td>Get a list of the users who are currently online</td>\n          </tr>\n        </tbody>\n      </Table>\n    </div>\n  )\n}","import React from 'react'\nimport classNames from 'classnames'\nimport reactStringReplace from 'react-string-replace'\nimport { IconProp, IconName } from '@fortawesome/fontawesome-svg-core'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { OverlayTrigger, Tooltip } from 'react-bootstrap'\n\nimport { Message } from 'store/types'\nimport styles from './index.module.scss'\nimport useGlobalState from 'store/state'\nimport HelpMessage from './HelpMessage'\n\ntype Props = {\n  message: Message\n}\n\nconst USER_REGEX = new RegExp('@([A-Za-z0-9]+(?:[_][A-Za-z0-9]+)*_?)', 'gmi');\nconst URL_REGEX = new RegExp(/((?:ftp|http|https):\\/\\/(?:\\w+:{0,1}\\w*@)?(?:\\S+)(?::[0-9]+)?(?:\\/|\\/(?:[\\w#!:.?+=&%@!\\-/]))?)/, 'gmi');\n\nexport default (props: Props) => {\n  const { state } = useGlobalState()\n\n  // User data comes from online users if available\n  const userData = state.onlineUsers.find(\n    user => user.user_id === props.message.user.user_id\n  ) || props.message.user\n\n  const userColor = `#${userData.color}`\n  const isSystem = userData.user_id === 'dotdot'\n  const isUserOnline = isSystem || (state.onlineUsers.findIndex(user => user.user_id === userData.user_id) > -1)\n\n  let iconName: IconName = 'circle'\n  if (userData.icon) {\n    iconName = userData.icon\n  } else if (userData.user_id === state.auth.user?.user_id) {\n    iconName = 'dot-circle'\n  }\n\n  // special icons\n  if (isSystem) {\n    iconName = 'cog'\n  } else if (props.message.attributes.draft) {\n    iconName = 'circle-notch'\n  } else if (props.message.attributes.private) {\n    iconName = 'lock'\n  } else if (!isUserOnline) {\n    iconName = 'meh'\n  }\n\n  let icon: IconProp = iconName\n  if (userData.user_id === state.auth.user?.user_id) {\n    icon = ['far', iconName]\n  }\n\n  let message\n\n  if (isSystem && props.message.message === '/help') {\n    message = (\n      <HelpMessage />\n    )\n  } else {\n    // replace mentions with colored version\n    message = reactStringReplace(props.message.message, USER_REGEX, (username, index) => {\n      let style = {}\n      const userIndex = state.onlineUsers.findIndex(user => user.name === username)\n      if (userIndex > -1) {\n        style = {\n          color: `#${state.onlineUsers[userIndex].color}`\n        }\n      }\n      return (\n        <span key={index} className={ styles.mention } style={ style }>\n          @{username}\n        </span>\n      );\n    })\n    // auto-link urls\n    message = reactStringReplace(message, URL_REGEX, (url) => {\n      return (\n        <a key={ url } href={ url } rel=\"noopener noreferrer\" target='_blank'>{ url }</a>\n      )\n    })\n  }\n\n  return (\n    <div\n      className={classNames(styles.message, {\n        [styles.system]: isSystem,\n        [styles.offline]: !isUserOnline,\n        [styles.inactive]: !userData.isActive,\n        [styles.draft]: props.message.attributes.draft,\n        [styles.private]: props.message.attributes.private,\n      })}\n      key={props.message.timestamp.toDateString()}\n    >\n      <div className={classNames(styles.icon, { [styles.private]: props.message.attributes.private })} style={{ color: userColor, background: userColor }}>\n        { props.message.attributes.private && (\n          <OverlayTrigger\n            placement=\"right\"\n            overlay={(\n              <Tooltip id={`user-${userData.user_id}`}>\n                Private message from <b>@{userData.name}</b><br />\n                Only you can see this.\n              </Tooltip>\n            )}\n          >\n            <FontAwesomeIcon icon={ icon } />\n          </OverlayTrigger>\n        ) }\n        { !props.message.attributes.private && (\n          <FontAwesomeIcon icon={ icon } spin={ props.message.attributes.draft } />\n        ) }\n      </div>\n      <div className={classNames(styles.timestamp)}>\n        {props.message.attributes.draft ? 'now' : props.message.timestamp.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' })}\n      </div>\n      <span\n        className={classNames(styles.user)}\n        style={ { color: userColor } }\n      >\n        {userData.name}\n      </span>\n      <div className={classNames(styles.body)}>\n        {message}\n      </div>\n    </div>\n  )\n}\n","import React, { useEffect, useCallback, useState, useRef } from 'react'\n\nconst SCROLL_THRESHOLD = 100\nconst SCROLL_DEBOUNCE_DELAY = 150\n\ntype Props = {\n  onScrollChanged?: (isAtBottom: boolean) => void,\n  boxRef: React.RefObject<HTMLElement | null>,\n  threshold?: number,\n  children?: any,\n}\n\nexport default ({ boxRef, onScrollChanged, threshold, children }: Props) => {\n  const [ scrollTop, setScrollTop ] = useState<number>(-1);\n  const [ height, setHeight ] = useState<number>(0);\n  const scrollDebounce = useRef<any>(null)\n\n  const onScrollDebounced = useCallback((isAtBottom: boolean) => {\n    clearTimeout(scrollDebounce.current)\n\n    if (onScrollChanged) {\n      scrollDebounce.current = setTimeout(() => {\n        onScrollChanged(isAtBottom)\n      }, SCROLL_DEBOUNCE_DELAY)\n    }\n  }, [onScrollChanged])\n\n  const scrollToBottom = useCallback(() => {\n    if (!boxRef || !boxRef.current) {\n      return\n    }\n\n    const scrollHeight = boxRef.current.scrollHeight - boxRef.current.offsetHeight\n    boxRef.current.scrollTop = scrollHeight\n\n    setScrollTop(boxRef.current.scrollTop)\n    onScrollDebounced(true)\n  }, [boxRef, onScrollDebounced, setScrollTop])\n\n  const updateScrollState = useCallback((shouldScroll: boolean) => () => {\n    if (!boxRef || !boxRef.current) {\n      return\n    }\n\n    if (scrollTop > 0) {\n      const customThreshold = threshold || SCROLL_THRESHOLD\n      if (scrollTop > 0 && Math.abs(boxRef.current.scrollTop - scrollTop) > customThreshold) {\n         // we are not at the bottom of the page, so we won't do anything\n        onScrollDebounced(false)\n        return\n      } else {\n        onScrollDebounced(true)\n      }\n    }\n\n    if (shouldScroll) {\n      scrollToBottom()\n    }\n  }, [boxRef, onScrollDebounced, threshold, scrollToBottom, scrollTop])\n\n  useEffect(() => {\n    window.addEventListener(\"resize\", scrollToBottom, true);\n\n    if (boxRef && boxRef.current) {\n      boxRef.current.addEventListener('scroll', updateScrollState(false), true)\n    }\n\n    // cleanup\n    return () => {\n      window.removeEventListener(\"resize\", scrollToBottom, true);\n    }\n  }, [boxRef, scrollToBottom, updateScrollState])\n\n  useEffect(() => {\n    // when the children changes, recalculate\n    if (!boxRef.current) {\n      return;\n    }\n    const newHeight = boxRef.current.scrollHeight;\n    if (newHeight !== height) {\n      setHeight(newHeight)\n      updateScrollState(true)()\n    }\n  }, [boxRef, height, updateScrollState, children])\n\n  return (\n    <>\n      { children }\n    </>\n  )\n}\n","import React, { useEffect, useRef, useCallback } from 'react'\nimport { Container, Button } from 'react-bootstrap'\nimport { useImmer } from 'use-immer'\nimport classNames from 'classnames'\n\nimport MessageComponent from './Message'\n\nimport styles from './index.module.scss'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport ScrollBox from './ScrollBox'\nimport useGlobalState from 'store/state'\n\ntype State = {\n  scrollAtBottom: boolean,\n  unseenMessages: boolean, // are there new messages below the scroll point?\n}\n\nexport default () => {\n  const { state } = useGlobalState()\n  const [localState, setLocalState] = useImmer<State>({\n    scrollAtBottom: true,\n    unseenMessages: false,\n  })\n\n  const chatAreaRef = useRef<HTMLDivElement>(null)\n\n  const onScrollChanged = useCallback((isAtBottom: boolean) => {\n    setLocalState(draft => {\n      draft.scrollAtBottom = isAtBottom\n      if (isAtBottom) {\n        draft.unseenMessages = false\n      }\n    })\n  }, [setLocalState])\n\n  const scrollToBottom = useCallback(() => {\n    if (!chatAreaRef || !chatAreaRef.current) {\n      return\n    }\n    const scrollHeight = chatAreaRef.current.scrollHeight - chatAreaRef.current.offsetHeight\n    chatAreaRef.current.scrollTop = scrollHeight\n\n    setLocalState(draft => {\n      draft.unseenMessages = false\n    })\n  }, [setLocalState])\n\n  useEffect(() => {\n    setLocalState(draft => {\n      draft.unseenMessages = !draft.scrollAtBottom\n    })\n  }, [state.messages, setLocalState])\n\n  // TODO set this on new messages: draft.unseenMessages = !draft.scrollAtBottom\n\n  return (\n    <div className={ styles.messages }>\n      { localState.unseenMessages && (\n        <div className={ classNames(styles.unseen) }>\n          <Container className={ styles.unseenContainer }>\n            <Button variant=\"outline-secondary\" size=\"sm\" onClick={ scrollToBottom }>\n              <FontAwesomeIcon icon='arrow-alt-circle-down' /> New messages\n            </Button>\n          </Container>\n        </div>\n      ) }\n        <div className={classNames(styles.messageScroll)} ref={chatAreaRef}>\n          <div className='container'>\n            <ScrollBox\n              boxRef={ chatAreaRef }\n              onScrollChanged={ onScrollChanged }\n            >\n              {state.messages.map((eachMessage) => (\n                <MessageComponent key={eachMessage.timestamp.getTime()} message={eachMessage} />\n              ))}\n            </ScrollBox>\n          </div>\n        </div>\n    </div>\n  )\n}\n","import React, { useContext, useRef } from 'react'\nimport { Form } from 'react-bootstrap'\nimport { useImmer } from 'use-immer'\nimport classNames from 'classnames'\n\nimport { SocketContext } from 'util/socketProvider'\nimport styles from './index.module.scss'\nimport { VALID_USERNAME } from '../../../constants'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { IconProp } from '@fortawesome/fontawesome-svg-core'\nimport useGlobalState from 'store/state'\nimport { EVENTS } from 'store/types'\n\ntype State = {\n  message: string\n  private: boolean\n  to: string | null\n  isCommand: boolean\n}\n\ntype Props = {\n  onFocus?: () => void\n  onBlur?: () => void\n}\n\nexport default ({ onFocus, onBlur }: Props) => {\n  const { state, dispatch } = useGlobalState()\n  const [localState, setState] = useImmer<State>({\n    message: '',\n    private: false,\n    to: null,\n    isCommand: false,\n  })\n  const draftTimer = useRef<any>(null)\n\n  const { socket } = useContext(SocketContext)\n\n  const askForHelp = () => {\n    dispatch({\n      type: 'system_message',\n      payload: '/help'\n    })\n  }\n\n  const handleSubmit = (e: React.ChangeEvent<any>) => {\n    e.preventDefault()\n\n    if (localState.message.length < 1 || localState.message.trim().length < 1) {\n      return\n    }\n\n    sendMessage(localState.message)\n\n    setState((draft) => {\n      draft.message = ''\n      draft.private = false\n      draft.isCommand = false\n    })\n  }\n\n  const sendMessage = (message: string, draft: boolean = false) => {\n    if (!draft && (message.length < 1 || message.trim().length < 1)) {\n      return\n    }\n\n    if (message === '/help') {\n      return askForHelp()\n    }\n\n    let type = EVENTS.MESSAGE\n    if (localState.isCommand) {\n      type = EVENTS.COMMAND\n    }\n    socket?.emit(type, {\n      message,\n      attributes: {\n        draft,\n        private: localState.private,\n        to: localState.to,\n      },\n    })\n  }\n\n  const onType = (e: React.ChangeEvent<any>) => {\n    e.preventDefault()\n\n    clearTimeout(draftTimer.current)\n\n    const value: string = e.currentTarget.value\n\n    // special messages\n    let isCommand = false\n    let isPM = false\n    let to: string | null = null\n\n    if (value[0] === '/') {\n      isCommand = true\n    } else if (value[0] === '@') {\n      const words = value.split(' ')\n      isPM = true\n      if (\n        words.length > 0 &&\n        words[0][0] === '@' &&\n        VALID_USERNAME.test(words[0].substr(1))\n      ) {\n        to = words[0].substr(1)\n      }\n    }\n\n    setState((draft) => {\n      draft.message = value\n      draft.private = isPM\n      draft.to = to\n      draft.isCommand = isCommand\n    })\n\n    if (isPM || isCommand) {\n      return\n    }\n\n    if (state.draftTimer > 0) {\n      draftTimer.current = setTimeout(() => {\n        sendMessage(value, true)\n      }, state.draftTimer)\n    }\n  }\n\n  let icon: IconProp = 'question-circle'\n  if (localState.isCommand) {\n    icon = 'code'\n  } else if (localState.private) {\n    icon = 'lock'\n  }\n\n  const onIconClick = () => {\n    if (icon !== 'question-circle') {\n      return\n    }\n    askForHelp()\n  }\n\n  return (\n    <Form\n      noValidate\n      onSubmit={handleSubmit}\n      className={classNames(styles.textBox, 'container', {\n        [styles.private]: localState.private,\n        [styles.command]: localState.isCommand,\n      })}\n    >\n      <Form.Group controlId=\"chatForm.message\">\n        <Form.Control\n          as=\"input\"\n          type=\"text\"\n          placeholder=\"Type a message...\"\n          autoFocus\n          onChange={onType}\n          onFocus={onFocus}\n          onBlur={onBlur}\n          value={localState.message}\n        />\n        <div className={styles.textIcon} onClick={onIconClick}>\n          <FontAwesomeIcon icon={icon} />\n        </div>\n      </Form.Group>\n    </Form>\n  )\n}\n","import React from 'react'\nimport { IconProp, IconName } from '@fortawesome/fontawesome-svg-core'\nimport { OverlayTrigger, Tooltip } from 'react-bootstrap'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\n\nimport styles from './index.module.scss'\nimport useGlobalState from 'store/state'\n\nexport default () => {\n  const { state } = useGlobalState();\n\n  return (\n    <div className={styles.onlineUsers}>\n      {\n        state.onlineUsers.map((user) => {\n          const isCurrentUser = user.user_id === state.auth.user?.user_id\n\n          let iconName: IconName = 'circle'\n          if (user.icon) {\n            iconName = user.icon\n          } else if (user.user_id === state.auth.user?.user_id) {\n            iconName = 'dot-circle'\n          }\n\n          if (!user.isActive) {\n            iconName = 'meh'\n          }\n\n          let icon: IconProp = iconName\n          if (isCurrentUser) {\n            icon = ['far', iconName]\n          }\n\n          return (\n            <OverlayTrigger\n              key={user.user_id}\n              placement=\"bottom\"\n              overlay={<Tooltip id={`user-${user.user_id}`}>@{user.name}</Tooltip>}\n            >\n              <span style={{ color: `#${user.color}` }}>\n                <FontAwesomeIcon icon={ icon } />\n              </span>\n            </OverlayTrigger>\n          )\n        })\n      }\n    </div>\n  )\n}\n","import { useEffect, useState } from 'react'\nimport axios, { AxiosRequestConfig, AxiosError } from 'axios'\n\nimport { API_URL } from '../constants'\n\nexport type FetchMethod = 'GET' | 'POST' | 'PUT' | 'DELETE'\nexport const CSRF_HEADER = 'x-csrf-token'\nlet csrfToken = ''\n\nexport type FetchError = {\n  status: number\n  message: string\n  errors: string[]\n  data?: any\n}\n\ntype FetchReturn<T> = [boolean, T | null, FetchError | null]\n\naxios.defaults.withCredentials = true\n\nfunction useFetch<T>(\n  path: string,\n  method: FetchMethod,\n  body?: any\n): FetchReturn<T> {\n  const [error, setError] = useState<FetchError | null>(null)\n  const [loading, setLoading] = useState<boolean>(true)\n  const [response, setResponse] = useState<T | null>(null)\n\n  useEffect(() => {\n    const sendRequest = async () => {\n      try {\n        const data = await fetchResource(path, method, body)\n        setResponse(data)\n      } catch (error) {\n        setError(error)\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    sendRequest()\n  }, [path, method, body])\n\n  return [loading, response, error]\n}\n\nexport const fetchResource = async (\n  path: string,\n  method: FetchMethod,\n  body?: any\n) => {\n  if (!path) {\n    throw new Error(`'url' is required for fetching data`)\n  }\n\n  const url = `${API_URL}${path}`\n  const options: AxiosRequestConfig = {\n    url,\n    method,\n    data: body,\n    timeout: 6000,\n    withCredentials: true,\n    xsrfHeaderName: CSRF_HEADER,\n    headers: {},\n  }\n\n  if (csrfToken.length > 0) {\n    options.headers[CSRF_HEADER] = csrfToken\n  }\n\n  try {\n    const response = await axios(options)\n\n    if (response.headers[CSRF_HEADER]) {\n      csrfToken = response.headers[CSRF_HEADER]\n    }\n\n    return await response.data\n  } catch (error) {\n    if (error.response) {\n      console.warn(`useFetch error on ${method} ${path}`, error.response)\n      const returnError: FetchError = {\n        status: error.response.status,\n        message: parseAxiosError(error),\n        errors: parseErrorList(error),\n        data: error.response.data\n      }\n      throw returnError\n    }\n\n    console.warn(`useFetch network error on ${method} ${path}`, error)\n    const returnError: FetchError = {\n      status: 500,\n      message: error.message,\n      errors: [error.message],\n    }\n    throw returnError\n  }\n}\n\nfunction parseAxiosError(error: AxiosError): string {\n  if (!error.response || !error.response.data) {\n    return error.message || 'An error occurred'\n  }\n\n  return parseErrorList(error).join('. ')\n}\n\nfunction parseErrorList(error: AxiosError): string[] {\n  const defaultError = 'An error occurred'\n  if (!error.response || !error.response.data) {\n    return [error.message || defaultError]\n  }\n\n  return parseErrors(\n    defaultError,\n    error.response.data,\n    error.response.data.errors,\n    error.response.data.error\n  )\n}\n\nfunction parseErrors(defaultError: string, ...errors: any[]): string[] {\n  for (let i = 0; i < errors.length; i++) {\n    const error = errors[i]\n    if (Array.isArray(error)) return error\n    if (typeof error === 'string') return [error]\n  }\n\n  return [defaultError]\n}\n\nexport default useFetch\n","import React, { useState } from 'react'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { OverlayTrigger, Tooltip, Button, Modal, Form } from 'react-bootstrap'\nimport classNames from 'classnames'\n\nimport styles from './index.module.scss'\nimport { fetchResource } from 'util/fetch'\nimport useGlobalState from 'store/state'\nimport { IconProp } from '@fortawesome/fontawesome-svg-core'\nimport { API_URL } from '../../../constants'\n\nexport default () => {\n  const { state, dispatch } = useGlobalState()\n\n  const [showModal, setShowModal] = useState<boolean>(false)\n  const [validated, setValidated] = useState<boolean>(false)\n\n  const [password, setPassword] = useState<string>('')\n  const [repeatPassword, setRepeatPassword] = useState<string>('')\n\n  const handleClose = () => setShowModal(false)\n  const handleShow = () => setShowModal(true)\n\n  const handleSubmit = (event: React.ChangeEvent<HTMLFormElement>) => {\n    event.preventDefault()\n    event.stopPropagation()\n\n    setValidated(true)\n\n    const form = event.currentTarget\n    if (!form.checkValidity()) {\n      return\n    }\n\n    const body = {\n      password,\n      repeatPassword,\n    }\n\n    fetchResource('/password', 'POST', body)\n      .then(() => {\n        dispatch({\n          type: 'user_password',\n          payload: true,\n        })\n\n        setShowModal(false)\n        setValidated(false)\n        setPassword('')\n        setRepeatPassword('')\n      })\n      .catch((reason) => {\n        dispatch({\n          type: 'error',\n          payload: reason.errors.join(', '),\n        })\n      })\n  }\n\n  let buttonClass = styles.unlocked\n  let buttonIcon: IconProp = 'lock-open'\n  let tooltipText = 'Set a password to keep your username'\n  let title = 'Claim Username'\n\n  if (state.auth.user && state.auth.user.hasPassword) {\n    buttonClass = styles.locked\n    buttonIcon = 'lock'\n    tooltipText = 'Change your password'\n    title = 'Update Password'\n  }\n\n  return (\n    <span className={styles.passwordLock}>\n      <OverlayTrigger\n        placement=\"bottom\"\n        delay={500}\n        overlay={<Tooltip id=\"passwordLock\">{tooltipText}</Tooltip>}\n      >\n        <Button variant=\"link\" className={buttonClass} style={ { padding: 0 } } onClick={handleShow}>\n          <FontAwesomeIcon icon={buttonIcon} />\n        </Button>\n      </OverlayTrigger>\n\n      <Modal show={showModal} onHide={handleClose}>\n        <Form noValidate validated={validated} onSubmit={handleSubmit}>\n          <Modal.Header closeButton>\n            <Modal.Title>\n              { title }\n            </Modal.Title>\n          </Modal.Header>\n\n          <Modal.Body>\n            <Form.Group controlId=\"pwd.new\">\n              <Form.Control\n                as=\"input\"\n                type=\"password\"\n                placeholder=\"Password...\"\n                autoFocus\n                required\n                minLength={6}\n                onChange={(event) => {\n                  setPassword(event.currentTarget.value)\n                }}\n                value={password}\n              />\n              <Form.Control.Feedback type=\"invalid\">\n                The password is too short. Minimum length is 6 characters.\n              </Form.Control.Feedback>\n            </Form.Group>\n\n            <Form.Group controlId=\"pwd.new\">\n              <Form.Control\n                as=\"input\"\n                type=\"password\"\n                placeholder=\"Repeat Password...\"\n                required\n                minLength={6}\n                pattern={password}\n                onChange={(event) => {\n                  setRepeatPassword(event.currentTarget.value)\n                }}\n                value={repeatPassword}\n              />\n              <Form.Control.Feedback type=\"invalid\">\n                The passwords don't match!\n              </Form.Control.Feedback>\n            </Form.Group>\n          </Modal.Body>\n          <Modal.Footer className={ styles.footer }>\n            <a href={ `${API_URL}/logout` } className={ classNames(styles.left, 'text-danger') }>\n              Logout\n            </a>\n\n            <Button type=\"submit\" variant=\"primary\">\n              Set password\n            </Button>\n          </Modal.Footer>\n        </Form>\n      </Modal>\n    </span>\n  )\n}\n","import React, { useEffect, useCallback } from 'react'\nimport classNames from 'classnames'\nimport { Container, Row, Col } from 'react-bootstrap'\nimport { Link } from 'react-router-dom'\n\nimport { useGlobalState } from 'store/state'\nimport Loader from 'components/Loader'\n\nimport styles from './index.module.scss'\nimport Messages from './Messages'\nimport TextBox from './TextBox'\nimport OnlineUsers from './OnlineUsers'\nimport PasswordLock from './PasswordLock'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { useImmer } from 'use-immer'\n\ntype State = {\n  isTextBoxFocused: boolean,\n  scrollingWhileFocused: boolean,\n}\n\nexport default () => {\n  const { state } = useGlobalState()\n  const [ localState, setState ] = useImmer<State>({\n    isTextBoxFocused: false,\n    scrollingWhileFocused: false,\n  })\n\n  let chatArea = <Loader />\n\n  // On window scroll\n  const setHeaderPosition = useCallback(() => {\n    setState(draft => {\n      if (draft.isTextBoxFocused) {\n        draft.scrollingWhileFocused = true\n      }\n    })\n    // eslint-disable-next-line\n  }, [setState]);\n\n  useEffect(() => {\n    window.addEventListener('scroll', setHeaderPosition, true)\n\n    return () => {\n      window.removeEventListener('scroll', setHeaderPosition)\n    }\n  }, [setHeaderPosition])\n\n  const handleTextBoxFocus = () => {\n    setState(draft => {\n      draft.isTextBoxFocused = true\n    })\n    setHeaderPosition()\n  }\n\n  const handleTextBoxBlur = () => {\n    setState(draft => {\n      draft.isTextBoxFocused = false\n      draft.scrollingWhileFocused = false\n    })\n  }\n\n  const headerStyle = {\n    position: 'static',\n    top: 0,\n  } as React.CSSProperties\n\n  if (localState.scrollingWhileFocused) {\n    headerStyle.position = 'absolute';\n    headerStyle.top = window.pageYOffset + 'px'\n  }\n\n  if (state.socket.connected) {\n    chatArea = (\n      <div className={classNames(styles.chat, { [styles.scrollingChat]: localState.scrollingWhileFocused })}>\n        <div className={classNames(styles.header)} style={headerStyle}>\n          <Container>\n            <Row>\n              <Col>\n                <PasswordLock />\n                {state.auth.user?.isAdmin && (\n                  <Link\n                    to=\"/admin\"\n                    title=\"Monitoring\"\n                    style={{ marginLeft: '1em' }}\n                  >\n                    <FontAwesomeIcon icon=\"shield-alt\" />\n                  </Link>\n                )}\n              </Col>\n              <Col>\n                <OnlineUsers />\n              </Col>\n            </Row>\n          </Container>\n        </div>\n\n        <Messages />\n        <TextBox onFocus={handleTextBoxFocus} onBlur={handleTextBoxBlur} />\n      </div>\n    )\n  }\n\n  return chatArea\n}\n","import React from 'react'\n\nimport Loader from 'components/Loader'\n\nexport default () => {\n  return (\n    <>\n      <Loader />\n    </>\n  )\n}\n","import React from 'react'\nimport { Route, Redirect } from 'react-router-dom'\nimport { useGlobalState } from 'store/state'\n\nimport Loading from 'sections/loading'\n\ntype Props = {\n  path: string\n  exact?: boolean\n  component?: React.ComponentType<any>\n}\n\n/**\n * This Route only allows browsing into if the user IS logged in\n */\nexport default (props: Props) => {\n  const { state } = useGlobalState()\n  if (!state.auth.checked) {\n    return <Loading />\n  }\n\n  if (!state.auth.loggedIn) {\n    return <Redirect to=\"/login\" />\n  }\n\n  return (\n    <Route path={props.path} exact={props.exact} component={props.component} />\n  )\n}\n","import React from 'react'\nimport { Route, Redirect } from 'react-router-dom'\nimport { useGlobalState } from 'store/state'\n\nimport Loading from 'sections/loading'\n\ntype Props = {\n  path: string\n  exact?: boolean\n  component?: React.ComponentType<any>\n}\n\n/**\n * This Route only allows browsing into if the user is NOT logged in\n */\nexport default (props: Props) => {\n  const { state } = useGlobalState()\n  if (!state.auth.checked) {\n    return <Loading />\n  }\n\n  if (state.auth.loggedIn) {\n    return <Redirect to=\"/\" />\n  }\n\n  return (\n    <Route path={props.path} exact={props.exact} component={props.component} />\n  )\n}\n","import React from 'react'\n\nimport { useGlobalState } from 'store/state'\nimport styles from './index.module.scss'\n\nexport default () => {\n  const { state } = useGlobalState()\n\n  if (!state.offline && !state.error) {\n    return null\n  }\n\n  let error = state.error\n  if (Array.isArray(error)) {\n    error = error.join('. ')\n  }\n  if (typeof error !== 'string') {\n    error = String(error)\n  }\n\n  if (state.error) {\n    return <div className={styles.offline}>Error: {error}</div>\n  }\n\n  return (\n    <div className={styles.offline}>\n      You seem to be offline! Please try again later\n    </div>\n  )\n}\n","import React, { useRef } from 'react'\nimport { Form, Container } from 'react-bootstrap'\nimport { useImmer } from 'use-immer'\nimport classNames from 'classnames'\nimport HCaptcha from \"react-hcaptcha\"\nimport ReCaptcha from \"react-google-recaptcha\"\n\nimport { useGlobalState } from 'store/state'\nimport { fetchResource } from 'util/fetch'\nimport Logo from 'components/Logo'\n\nimport styles from './index.module.scss'\nimport { AuthData } from 'store/types'\nimport { CAPTCHA_KEY, CAPTCHA_PROVIDER } from '../../constants'\n\ntype State = {\n  username: string\n  password: string\n  verified: boolean\n  hasPassword: boolean\n  loading: boolean\n}\n\nexport default () => {\n  const { dispatch } = useGlobalState()\n  const [localState, setState] = useImmer<State>({\n    username: '',\n    password: '',\n    verified: false,\n    hasPassword: false,\n    loading: false,\n  })\n\n  const captchaRef = useRef<any>(null)\n\n  const handleSubmit = (e: React.ChangeEvent<any>) => {\n    e.preventDefault()\n    if (localState.verified) {\n      oncaptchaChange('verified')\n      return\n    }\n    captchaRef.current.execute()\n  };\n\n  const oncaptchaChange = (token: string | null) => {\n    if (!token || localState.loading) {\n      return\n    }\n\n    setState((draft) => {\n      draft.loading = true\n    })\n\n    const body = {\n      username: localState.username,\n      password: localState.password,\n      captchaToken: token,\n    }\n    fetchResource('/auth', 'POST', body)\n      .then((data: AuthData) => {\n        if (captchaRef.current.resetCaptcha) {\n          captchaRef.current.resetCaptcha()\n        }\n\n        if (!data || !data.user.user_id) {\n          console.warn('Invalid user object')\n          dispatch({\n            type: 'login',\n            payload: null,\n          })\n          return\n        }\n\n        dispatch({\n          type: 'login',\n          payload: data,\n        })\n      })\n      .catch((reason) => {\n        if (reason.status !== 400) {\n          // username requires password\n          dispatch({\n            type: 'error',\n            payload: reason.errors.join(', '),\n          })\n        }\n\n        if (captchaRef.current.resetCaptcha) {\n          captchaRef.current.resetCaptcha()\n        }\n\n        setState((draft) => {\n          draft.loading = false\n          draft.verified = (reason.data && reason.data.verified) || false\n          if (reason.status === 400) {\n            draft.hasPassword = true\n          }\n        })\n      }\n    )\n  }\n\n  let theme: 'light' | 'dark' = 'light'\n  if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {\n    theme = 'dark'\n  }\n\n  return (\n    <Container className={classNames(styles.login, 'mt-4')}>\n      <Logo />\n      <Form noValidate onSubmit={handleSubmit}>\n        <Form.Group controlId=\"loginForm.username\">\n          <Form.Control\n            as=\"input\"\n            type=\"text\"\n            placeholder=\"What's your name?\"\n            disabled={localState.loading}\n            autoFocus\n            minLength={ 1 }\n            maxLength={ 20 }\n            onChange={(e) => {\n              const value = e.currentTarget.value\n              setState((draft) => {\n                draft.username = value\n              })\n            }}\n            value={localState.username}\n          />\n          {localState.hasPassword && (\n            <Form.Control\n              as=\"input\"\n              className=\"mt-2\"\n              type=\"password\"\n              placeholder=\"Password...\"\n              disabled={localState.loading}\n              autoFocus\n              onChange={(e) => {\n                const value = e.currentTarget.value\n                setState((draft) => {\n                  draft.password = value\n                })\n              }}\n              value={localState.password}\n            />\n          )}\n          { CAPTCHA_PROVIDER === 'recaptcha' && (\n            <ReCaptcha\n              ref={ captchaRef }\n              size='invisible'\n              theme={ theme }\n              sitekey={ CAPTCHA_KEY }\n              onChange={ oncaptchaChange }\n            />\n          )}\n          { CAPTCHA_PROVIDER === 'hcaptcha' && (\n            <HCaptcha\n              ref={ captchaRef }\n              size='invisible'\n              theme={ theme }\n              sitekey={ CAPTCHA_KEY }\n              onVerify={ oncaptchaChange }\n            />\n          )}\n          <button type=\"submit\" style={{ visibility: 'hidden' }}>\n            Login\n          </button>\n        </Form.Group>\n      </Form>\n    </Container>\n  )\n}\n","import { Action, AuthData } from 'store/types'\n\nimport { fetchResource } from './fetch'\n\nconst OFFLINE_RETRY_DELAY = 2000\n\nexport const checkAuth = (dispatch: React.Dispatch<Action>) => {\n  fetchResource('/auth', 'GET')\n    .then((data: AuthData) => {\n      if (!data || !data.user.user_id) {\n        console.warn('Invalid user object')\n        dispatch({\n          type: 'login',\n          payload: null,\n        })\n        return\n      }\n\n      dispatch({\n        type: 'login',\n        payload: data,\n      })\n    })\n    .catch((reason) => {\n      if (reason.message === 'Network Error') {\n        dispatch({\n          type: 'offline',\n          payload: null,\n        })\n\n        // try again\n        setTimeout(() => {\n          checkAuth(dispatch)\n        }, OFFLINE_RETRY_DELAY)\n      } else {\n        if (reason.status !== 401) {\n          dispatch({\n            type: 'error',\n            payload: reason.errors.join(', '),\n          })\n        }\n\n        dispatch({\n          type: 'login',\n          payload: null,\n        })\n      }\n    })\n}\n\nexport default checkAuth\n","import React, { useEffect } from 'react'\nimport { Switch } from 'react-router-dom'\n\nimport Chat from 'sections/Chat'\nimport AuthenticatedRoute from 'util/AuthenticatedRoute'\nimport UnauthenticatedRoute from 'util/UnauthenticatedRoute'\nimport OfflineCheck from 'components/OfflineCheck'\nimport Login from 'sections/Login'\nimport useGlobalState from 'store/state'\nimport checkAuth from 'util/checkAuth'\nimport Admin from 'sections/Admin'\n\nexport default () => {\n  const { state, dispatch } = useGlobalState()\n\n  // Check authentication state\n  useEffect(() => {\n    if (!state.auth.checked) {\n      checkAuth(dispatch)\n    }\n  }, [state.auth.checked, dispatch])\n\n  return (\n    <>\n      <OfflineCheck />\n      <Switch>\n        <UnauthenticatedRoute path=\"/login\" component={Login} />\n        <AuthenticatedRoute path=\"/admin\" component={Admin} />\n        <AuthenticatedRoute path=\"/\" component={Chat} />\n      </Switch>\n    </>\n  )\n}\n","import React, { useEffect, useContext, useCallback } from 'react'\nimport Helmet from 'react-helmet'\nimport useSound from 'use-sound'\nimport { useImmer } from 'use-immer'\n\nimport { SocketContext } from 'util/socketProvider'\nimport { Message } from 'store/types'\nimport useGlobalState from 'store/state'\nimport newMessageSound from 'assets/sounds/newMessage.mp3'\nimport { dateDiff } from 'lib/dateDiff'\n\nconst TIME_BETWEEN_SOUND = 5 * 1000 // ms\nconst NOTIFICATION_VOLUME = 0.5 // 0-1\n\ntype State = {\n  lastSound: Date | null,\n  windowFocused: boolean,\n  titleNotification: boolean,\n}\n\nexport default () => {\n  const { state } = useGlobalState();\n  const [ localState, setState ] = useImmer<State>({\n    lastSound: new Date(),\n    windowFocused: true,\n    titleNotification: false,\n  })\n\n  const { socket } = useContext(SocketContext)\n  const [ play ] = useSound(newMessageSound, {\n    interrupt: true,\n    volume: NOTIFICATION_VOLUME,\n  });\n\n  const onMessage = useCallback((user_id: string) => (msg: Message) => {\n    if (msg.attributes.draft || user_id === msg.user.user_id) {\n      return\n    }\n\n    setState(draft => {\n      if (!draft.windowFocused) {\n        draft.titleNotification = true;\n\n        if (!draft.lastSound || dateDiff(draft.lastSound) > TIME_BETWEEN_SOUND) {\n          draft.lastSound = new Date()\n          play({})\n        }\n      }\n    })\n  }, [setState, play])\n\n  const onFocus = useCallback(() => {\n    setState(draft => {\n      draft.titleNotification = false\n      draft.windowFocused = true\n    })\n  }, [setState])\n\n  const onBlur = useCallback(() => {\n    setState(draft => {\n      draft.windowFocused = false\n    })\n  }, [setState])\n\n  const user_id = state.auth.user ? state.auth.user.user_id : null\n\n  useEffect(() => {\n    if (!socket || !user_id) {\n      return\n    }\n    socket.on('message', onMessage(user_id))\n  }, [socket, onMessage, user_id])\n\n  useEffect(() => {\n    window.addEventListener('focus', onFocus)\n    window.addEventListener('blur', onBlur)\n\n    return () => {\n      window.removeEventListener('focus', onFocus)\n      window.removeEventListener('blur', onBlur)\n    }\n  }, [onFocus, onBlur])\n\n  return (\n    <Helmet>\n      <title>{localState.titleNotification ? ' dotdot' : 'dotdot'}</title>\n    </Helmet>\n  )\n}\n","/**\n * Get the difference between two date objects in ms\n */\nexport const dateDiff = (t1: Date, t2: Date = new Date()) => {\n  return t2.getTime() - t1.getTime();\n};","import { library } from '@fortawesome/fontawesome-svg-core'\n\n/**\n * Icon Preloading\n * This is done so that only the icons that we need are loaded from FontAwesome\n */\n\n// Icons available in two styles, regular and solid\n// solid tends to have all free icons, while some regular ones are PRO only\nimport {\n  faLock,\n  faLockOpen,\n  faCircle,\n  faDotCircle,\n  faCircleNotch,\n  faCode,\n  faCog,\n  faArrowAltCircleDown,\n  faMeh,\n  faAngry,\n  faDizzy,\n  faFlushed,\n  faFrown,\n  faFrownOpen,\n  faGrimace,\n  faGrin,\n  faGrinAlt,\n  faGrinBeam,\n  faGrinBeamSweat,\n  faGrinHearts,\n  faGrinSquint,\n  faGrinSquintTears,\n  faGrinStars,\n  faGrinTears,\n  faGrinTongue,\n  faGrinTongueSquint,\n  faGrinTongueWink,\n  faGrinWink,\n  faKiss,\n  faKissBeam,\n  faKissWinkHeart,\n  faLaugh,\n  faLaughBeam,\n  faLaughSquint,\n  faLaughWink,\n  faMehBlank,\n  faMehRollingEyes,\n  faSadCry,\n  faSadTear,\n  faSmile,\n  faSmileBeam,\n  faSmileWink,\n  faSurprise,\n  faTired,\n  faShieldAlt,\n  faQuestionCircle,\n} from '@fortawesome/free-solid-svg-icons'\n\nimport {\n  faDotCircle as farDotCircle,\n  faMeh as farMeh,\n  faAngry as farAngry,\n  faDizzy as farDizzy,\n  faFlushed as farFlushed,\n  faFrown as farFrown,\n  faFrownOpen as farFrownOpen,\n  faGrimace as farGrimace,\n  faGrin as farGrin,\n  faGrinAlt as farGrinAlt,\n  faGrinBeam as farGrinBeam,\n  faGrinBeamSweat as farGrinBeamSweat,\n  faGrinHearts as farGrinHearts,\n  faGrinSquint as farGrinSquint,\n  faGrinSquintTears as farGrinSquintTears,\n  faGrinStars as farGrinStars,\n  faGrinTears as farGrinTears,\n  faGrinTongue as farGrinTongue,\n  faGrinTongueSquint as farGrinTongueSquint,\n  faGrinTongueWink as farGrinTongueWink,\n  faGrinWink as farGrinWink,\n  faKiss as farKiss,\n  faKissBeam as farKissBeam,\n  faKissWinkHeart as farKissWinkHeart,\n  faLaugh as farLaugh,\n  faLaughBeam as farLaughBeam,\n  faLaughSquint as farLaughSquint,\n  faLaughWink as farLaughWink,\n  faMehBlank as farMehBlank,\n  faMehRollingEyes as farMehRollingEyes,\n  faSadCry as farSadCry,\n  faSadTear as farSadTear,\n  faSmile as farSmile,\n  faSmileBeam as farSmileBeam,\n  faSmileWink as farSmileWink,\n  faSurprise as farSurprise,\n  faTired as farTired,\n} from '@fortawesome/free-regular-svg-icons'\n\n/**\n * All icons that will be used in this app need to be preloaded here\n */\nlibrary.add(\n  faLock,\n  faLockOpen,\n  faCircle,\n  faDotCircle,\n  farDotCircle,\n  faCircleNotch,\n  faCode,\n  faCog,\n  faArrowAltCircleDown,\n  faMeh,\n  farMeh,\n  faAngry,\n  faDizzy,\n  faFlushed,\n  faFrown,\n  faFrownOpen,\n  faGrimace,\n  faGrin,\n  faGrinAlt,\n  faGrinBeam,\n  faGrinBeamSweat,\n  faGrinHearts,\n  faGrinSquint,\n  faGrinSquintTears,\n  faGrinStars,\n  faGrinTears,\n  faGrinTongue,\n  faGrinTongueSquint,\n  faGrinTongueWink,\n  faGrinWink,\n  faKiss,\n  faKissBeam,\n  faKissWinkHeart,\n  faLaugh,\n  faLaughBeam,\n  faLaughSquint,\n  faLaughWink,\n  faMehBlank,\n  faMehRollingEyes,\n  faSadCry,\n  faSadTear,\n  faSmile,\n  faSmileBeam,\n  faSmileWink,\n  faSurprise,\n  faTired,\n  farAngry,\n  farDizzy,\n  farFlushed,\n  farFrown,\n  farFrownOpen,\n  farGrimace,\n  farGrin,\n  farGrinAlt,\n  farGrinBeam,\n  farGrinBeamSweat,\n  farGrinHearts,\n  farGrinSquint,\n  farGrinSquintTears,\n  farGrinStars,\n  farGrinTears,\n  farGrinTongue,\n  farGrinTongueSquint,\n  farGrinTongueWink,\n  farGrinWink,\n  farKiss,\n  farKissBeam,\n  farKissWinkHeart,\n  farLaugh,\n  farLaughBeam,\n  farLaughSquint,\n  farLaughWink,\n  farMehBlank,\n  farMehRollingEyes,\n  farSadCry,\n  farSadTear,\n  farSmile,\n  farSmileBeam,\n  farSmileWink,\n  farSurprise,\n  farTired,\n  faShieldAlt,\n  faQuestionCircle\n)\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport { BrowserRouter } from 'react-router-dom'\n\nimport { StateProvider } from 'store/state'\nimport SocketProvider from 'util/socketProvider'\n\nimport Router from './router'\nimport Title from './components/Title'\n\nimport './lib/icons'\nimport 'assets/scss/index.scss'\n\n\nconst app = (\n  <BrowserRouter basename={process.env.REACT_APP_BASEPATH}>\n    <StateProvider>\n      <SocketProvider>\n        <Title />\n        <Router />\n      </SocketProvider>\n    </StateProvider>\n  </BrowserRouter>\n)\n\nReactDOM.render(app, document.getElementById('root'))\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"passwordLock\":\"PasswordLock_passwordLock__2FTiA\",\"unlocked\":\"PasswordLock_unlocked__21MTQ\",\"pulse\":\"PasswordLock_pulse__2T-_F\",\"locked\":\"PasswordLock_locked__1mCl-\",\"footer\":\"PasswordLock_footer__3PO9z\",\"left\":\"PasswordLock_left__3Gmj3\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"logo\":\"Logo_logo__30xDu\",\"svgFilter\":\"Logo_svgFilter__1s9i7\",\"blob\":\"Logo_blob__1iSwo\",\"blob-first\":\"Logo_blob-first__3YKrD\",\"blob-second\":\"Logo_blob-second__2r5Nx\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"messages\":\"Messages_messages__tCmp1\",\"messageScroll\":\"Messages_messageScroll__CCnSp\",\"unseen\":\"Messages_unseen__gVw6f\",\"unseenContainer\":\"Messages_unseenContainer__3haBw\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"textBox\":\"TextBox_textBox__McZeC\",\"textIcon\":\"TextBox_textIcon__mlsnG\",\"private\":\"TextBox_private__1kesE\",\"command\":\"TextBox_command__1uXWO\"};"],"sourceRoot":""}